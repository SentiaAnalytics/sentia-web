machine:
  services:
    - docker
  ruby:
    version: rbx-2.2.6
  node:
    version: 0.10.22
  python:
    version: pypy-2.2.1

  environment:
    SENTIA_PROJECT: sentia-analytics
    SENTIA_ZONE: europe-west1-b
    SENTIA_CLUSTER: web-cluster
    TEST_MODE: ff
    PATH: ~/web/google-cloud-sdk/bin:$PATH
    CLOUDSDK_PYTHON_SITEPACKAGES: 1

dependencies:
  override:
    - ci/install_gcloud
    # - npm install
    # - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS

test:
  pre:
    # - docker build -t cullophid/sentia:$CIRCLE_BUILD_NUM .
    # - ci/run_docker:
    #     background:
    #       true
  override:
    # - npm test
    # - ci/cucumber


deployment:
  hub:
    branch: react
    commands:
      - echo "deploy"
      - kubectl rolling-update web-controller --image=cullophid/sentia:250
      # - docker push cullophid/sentia:$CIRCLE_BUILD_NUM
      # - docker pull cullophid/deploy-web
      # - docker run -e BUILD=273 cullophid/deploy-web
