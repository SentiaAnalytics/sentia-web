machine:
  services:
    - docker
  ruby:
    version: rbx-2.2.6
  node:
    version: 0.10.22

  environment:
    TEST_MODE: ff
    PATH: /home/ubuntu/web/google-cloud-sdk/bin:$PATH

dependencies:
  pre:
    - sh ci/install_gcloud.sh
    - sh ci/setup_gcloud.sh
  override:
    - npm install

test:
  pre:
    - npm test
  override:
    - docker build -t gcr.io/sentia_analytics/web:$CIRCLE_BUILD_NUM .
    - sh ci/run_docker.sh && sleep 5 && sh ci/run_cucumber.sh
