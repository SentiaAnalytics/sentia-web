machine:
  services:
    - docker
  ruby:
    version: rbx-2.2.6
  node:
    version: 0.10.22

dependencies:
  pre:
    - sudo npm i -g phantomjs
    - phantomjs --version
  override:
    - npm install

test:
  override:
    - npm test
    - docker build -t gcr.io/sentia_analytics/web:$CIRCLE_BUILD_NUM .
    - sh ci/runDocker.sh && sleep 5
    - curl --retry 10 --retry-delay 5 -v http://localhost:3000
    - cd cucumber && bundle install && bundle exec cucumber
